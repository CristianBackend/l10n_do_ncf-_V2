<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="report_invoice_ncf_ticket">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="l10n_do_ncf.report_invoice_ncf_ticket_document" t-lang="lang"/>
            </t>
        </t>
    </template>

    <template id="report_invoice_ncf_ticket_document">
        <t t-set="print_time" t-value="datetime.datetime.now().strftime('%d/%m/%Y %H:%M:%S')"/>
        <div style="font-family: 'Courier New', Courier, monospace; font-size: 12px; width: 80mm; margin: 0 auto; padding: 5mm; line-height: 1.4;">
            
            <!-- ENCABEZADO EMPRESA -->
            <div style="text-align: center; margin-bottom: 3mm;">
                <div style="font-size: 14px; font-weight: bold;">
                    <t t-esc="o.company_id.name"/>
                </div>
                <t t-if="o.company_id.street">
                    <div><t t-esc="o.company_id.street"/></div>
                </t>
                <t t-if="o.company_id.city">
                    <div><t t-esc="o.company_id.city"/><t t-if="o.company_id.state_id">, <t t-esc="o.company_id.state_id.name"/></t></div>
                </t>
                <div>RNC: <t t-esc="o.company_id.vat"/></div>
                <t t-if="o.company_id.phone">
                    <div>Tel: <t t-esc="o.company_id.phone"/></div>
                </t>
            </div>

            <!-- TIPO DOCUMENTO Y NCF -->
            <div style="text-align: center; margin-bottom: 2mm;">
                <div style="font-weight: bold;">
                    <t t-if="o.move_type == 'out_invoice'">FACTURA DE VENTA</t>
                    <t t-if="o.move_type == 'out_refund'">NOTA DE CREDITO</t>
                </div>
                <div>No.: <t t-esc="o.name"/></div>
                <div>Fecha: <t t-esc="o.invoice_date"/></div>
                <div>Impreso: <t t-esc="print_time"/></div>
            </div>

            <!-- NCF DESTACADO -->
            <div style="text-align: center; margin: 3mm 0; padding: 2mm 0; border-top: 1px dashed #000; border-bottom: 1px dashed #000;">
                <div style="font-weight: bold;">NCF: <t t-esc="o.l10n_do_ncf_number"/></div>
                <div style="font-size: 10px;"><t t-esc="o.l10n_do_ncf_type_id.name"/></div>
                <t t-if="o.l10n_do_ncf_expiration">
                    <div style="font-size: 10px;">Vence: <t t-esc="o.l10n_do_ncf_expiration"/></div>
                </t>
            </div>

            <!-- DATOS DEL CLIENTE -->
            <div style="margin-bottom: 3mm; border-bottom: 1px dashed #000; padding-bottom: 2mm;">
                <div>======== Datos del Cliente ========</div>
                <div>Cliente  : <t t-esc="o.partner_id.name"/></div>
                <t t-if="o.partner_id.vat">
                    <div>RNC/Ced. : <t t-esc="o.partner_id.vat"/></div>
                </t>
                <t t-if="o.partner_id.street">
                    <div>Dir.     : <t t-esc="o.partner_id.street"/></div>
                </t>
                <t t-if="o.partner_id.phone">
                    <div>Tel.     : <t t-esc="o.partner_id.phone"/></div>
                </t>
            </div>

            <!-- DETALLE DE PRODUCTOS -->
            <div style="margin-bottom: 3mm;">
                <div style="border-bottom: 1px solid #000; margin-bottom: 2mm; font-weight: bold;">
                    <span>Descripcion</span>
                    <span style="float: right;">Total</span>
                </div>
                <t t-set="lines" t-value="o.invoice_line_ids.filtered(lambda l: l.display_type not in ('line_section', 'line_note'))"/>
                <t t-foreach="lines" t-as="line">
                    <div style="margin-bottom: 2mm;">
                        <div><t t-esc="line.product_id.name or line.name"/></div>
                        <div>
                            <span style="margin-left: 10px;"><t t-esc="'%.2f' % line.quantity"/> x <t t-esc="'%.2f' % line.price_unit"/></span>
                            <span style="float: right; font-weight: bold;"><t t-esc="'%.2f' % line.price_subtotal"/></span>
                        </div>
                    </div>
                </t>
            </div>

            <!-- SEPARADOR -->
            <div style="border-top: 1px dashed #000; margin: 2mm 0;"></div>

            <!-- TOTALES -->
            <div style="margin-bottom: 3mm;">
                <div>Subtotal<span style="float: right;"><t t-esc="'%.2f' % o.amount_untaxed"/></span></div>
                <div>ITBIS (18%)<span style="float: right;"><t t-esc="'%.2f' % o.amount_tax"/></span></div>
                <div style="font-weight: bold; font-size: 14px; border-top: 1px solid #000; padding-top: 2mm; margin-top: 2mm;">
                    TOTAL RD$<span style="float: right;"><t t-esc="'%.2f' % o.amount_total"/></span>
                </div>
            </div>

            <!-- ESTADO DE PAGO -->
            <t t-if="o.payment_state == 'paid'">
                <div style="text-align: center; margin: 3mm 0; padding: 2mm; border: 1px solid #000;">
                    <div>Monto Pagado.> <t t-esc="'%.2f' % o.amount_total"/></div>
                    <div>Devuelta.....> 0.00</div>
                </div>
            </t>
            <t t-else="">
                <div style="text-align: center; margin: 3mm 0; padding: 2mm; border: 1px dashed #000;">
                    <div>** PENDIENTE DE PAGO **</div>
                    <div>Monto a Pagar: <t t-esc="'%.2f' % o.amount_residual"/></div>
                </div>
            </t>

            <!-- VENDEDOR/CAJERO -->
            <div style="text-align: center; margin: 3mm 0; border-top: 1px dashed #000; padding-top: 2mm;">
                <t t-if="o.invoice_user_id">
                    <div><t t-esc="o.invoice_user_id.name"/></div>
                    <div>Vendedor</div>
                </t>
            </div>

            <!-- MENSAJE FINAL -->
            <div style="text-align: center; margin-top: 5mm; font-size: 11px;">
                <div>================================</div>
                <div style="font-weight: bold;">GRACIAS POR SU COMPRA</div>
                <div>================================</div>
                <div style="margin-top: 2mm; font-size: 10px;">
                    Conserve este recibo para cualquier reclamacion
                </div>
            </div>

            <!-- INFORMACION FISCAL AL PIE -->
            <div style="text-align: center; margin-top: 5mm; font-size: 9px; border-top: 1px dashed #000; padding-top: 2mm;">
                <div>NCF: <t t-esc="o.l10n_do_ncf_number"/></div>
                <div>RNC Emisor: <t t-esc="o.company_id.vat"/></div>
                <div>RNC Cliente: <t t-esc="o.partner_id.vat or 'N/A'"/></div>
            </div>

        </div>
    </template>

</odoo>
