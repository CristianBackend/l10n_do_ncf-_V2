<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Extensión de la vista de factura -->
    <record id="view_move_form_ncf" model="ir.ui.view">
        <field name="name">account.move.form.ncf</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            
            <!-- Agregar campos NCF después del partner -->
            <field name="partner_id" position="after">
                <field name="l10n_do_ncf_type_id" 
                       invisible="move_type not in ('out_invoice', 'out_refund')"
                       required="move_type in ('out_invoice', 'out_refund') and company_id.country_id.code == 'DO'"
                       options="{'no_create': True}"/>
                <field name="l10n_do_ncf_number" 
                       invisible="move_type not in ('out_invoice', 'out_refund')"
                       readonly="1"/>
            </field>
            
            <!-- Campos para facturas de proveedor -->
            <field name="invoice_date" position="after">
                <field name="l10n_do_vendor_ncf" 
                       invisible="move_type not in ('in_invoice', 'in_refund')"
                       placeholder="B0100000001"/>
                <field name="l10n_do_vendor_ncf_validated" 
                       invisible="move_type not in ('in_invoice', 'in_refund')"
                       readonly="1"/>
            </field>
            
            <!-- NCF origen para notas de crédito/débito -->
            <field name="l10n_do_ncf_number" position="after">
                <field name="l10n_do_ncf_origin" 
                       invisible="move_type not in ('out_refund', 'in_refund')"
                       placeholder="NCF de factura original"/>
            </field>
            
            <!-- Tipo de gasto para compras -->
            <xpath expr="//page[@name='other_info']//group[@name='accounting_info_group']" position="inside">
                <field name="l10n_do_expense_type" invisible="move_type not in ('in_invoice', 'in_refund')"/>
                <field name="l10n_do_fiscal_type"/>
            </xpath>
            
            <!-- Botón para validar NCF de proveedor -->
            <xpath expr="//header" position="inside">
                <button name="action_validate_vendor_ncf" 
                        string="Validar NCF" 
                        type="object" 
                        class="btn-secondary"
                        invisible="move_type not in ('in_invoice', 'in_refund') or not l10n_do_vendor_ncf or l10n_do_vendor_ncf_validated"/>
            </xpath>
            
        </field>
    </record>
    
    <!-- Extensión de la vista tree de facturas -->
    <record id="view_move_tree_ncf" model="ir.ui.view">
        <field name="name">account.move.tree.ncf</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_out_invoice_tree"/>
        <field name="arch" type="xml">
            <field name="name" position="after">
                <field name="l10n_do_ncf_number" optional="show"/>
            </field>
        </field>
    </record>
    
    <!-- También para facturas de proveedor -->
    <record id="view_in_invoice_tree_ncf" model="ir.ui.view">
        <field name="name">account.move.tree.vendor.ncf</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_in_invoice_tree"/>
        <field name="arch" type="xml">
            <field name="name" position="after">
                <field name="l10n_do_vendor_ncf" optional="show"/>
            </field>
        </field>
    </record>
    
</odoo>
